<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-advanced" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">高级选项和配置 | RKE2</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.rke2.io/zh/advanced"><meta data-rh="true" property="og:locale" content="zh"><meta data-rh="true" property="og:locale:alternate" content="en"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="高级选项和配置 | RKE2"><meta data-rh="true" name="description" content="本文描述了用于运行和管理 RKE2 的高级设置："><meta data-rh="true" property="og:description" content="本文描述了用于运行和管理 RKE2 的高级设置："><link data-rh="true" rel="icon" href="/zh/img/favicon.png"><link data-rh="true" rel="canonical" href="https://docs.rke2.io/zh/advanced"><link data-rh="true" rel="alternate" href="https://docs.rke2.io/advanced" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.rke2.io/zh/advanced" hreflang="zh"><link data-rh="true" rel="alternate" href="https://docs.rke2.io/advanced" hreflang="x-default"><link rel="preconnect" href="https://www.googletagmanager.com">
<script>window.dataLayer=window.dataLayer||[]</script>
<script>!function(e,t,a,n,g){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var m=t.getElementsByTagName(a)[0],r=t.createElement(a);r.async=!0,r.src="https://www.googletagmanager.com/gtm.js?id=GTM-57KS2MW",m.parentNode.insertBefore(r,m)}(window,document,"script","dataLayer")</script><link rel="stylesheet" href="/zh/assets/css/styles.f870f7f9.css">
<script src="/zh/assets/js/runtime~main.a46e8412.js" defer="defer"></script>
<script src="/zh/assets/js/main.a922fbab.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-57KS2MW" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh/"><div class="navbar__logo"><img src="/zh/img/logo-horizontal-rke2.svg" alt="logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/zh/img/logo-horizontal-rke2-dark.svg" alt="logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a></div><div class="navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="搜索" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>简体中文</a><ul class="dropdown__menu"><li><a href="/advanced" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li><li><a href="/zh/advanced" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh">简体中文</a></li></ul></div><a href="https://github.com/rancher/rke2" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar__icon navbar__github">GitHub</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">More From SUSE</a><ul class="dropdown__menu"><li><a href="https://www.rancher.com" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__rancher">Rancher</a></li><li><hr style="margin: 0.3rem 0;"></li><li><a href="http://harvesterhci.io" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__harvester">Harvester</a></li><li><a href="https://rancherdesktop.io" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__rd">Rancher Desktop</a></li><li><a href="https://kubewarden.io" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__kubewarden">Kubewarden</a></li><li><hr style="margin: 0.3rem 0;"></li><li><a href="https://opensource.suse.com" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__suse">More Projects...</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/">介绍</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/install/quickstart">安装</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/upgrade">升级</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/security/about_hardened_images">安全</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/architecture">架构</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/cluster_access">集群访问</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/backup_restore">Etcd 备份与恢复</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/networking">网络</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/helm">Helm 集成</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/zh/advanced">高级选项和配置</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/reference/cli_tools">参考</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/release-notes/v1.24.X">Release Notes</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/known_issues">已知问题和限制</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/zh/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">高级选项和配置</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>高级选项和配置</h1></header><p>本文描述了用于运行和管理 RKE2 的高级设置：</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="证书轮换">证书轮换<a href="#证书轮换" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h2>
<p>默认情况下，RKE2 中的证书在 12 个月后过期。</p>
<p>如果证书已经过期或剩余的时间不足 90 天，则在 RKE2 重启时轮换证书。</p>
<p>从 v1.21.8+rke2r1 开始，你可以手动轮换证书。为此，建议先停止 rke2-server 进程，然后轮换证书，最后再次启动该进程：</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">systemctl stop rke2-server</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">rke2 certificate rotate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">systemctl start rke2-server</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>你也可以通过传递 <code>--service</code> 标志来轮换单个服务，例如：<code>rke2 certificate rotate --service api-server</code>。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="自动部署清单">自动部署清单<a href="#自动部署清单" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h2>
<p>在 <code>/var/lib/rancher/rke2/server/manifests</code> 中找到的任何文件都会以类似于 <code>kubectl apply</code> 的方式自动部署到 Kubernetes。</p>
<p>有关使用清单目录部署 Helm Chart 的信息，请参阅 <a href="/zh/helm">Helm</a> 章节。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="配置-containerd">配置 Containerd<a href="#配置-containerd" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h2>
<p>RKE2 会在 <code>/var/lib/rancher/rke2/agent/etc/containerd/config.toml</code> 中为 containerd 生成 <code>config.toml</code>。</p>
<p>如果要对这个文件进行高级定制，你可以在同一目录中创建另一个名为 <code>config.toml.tmpl</code> 的文件，此文件将会代替默认设置。</p>
<p><code>config.toml.tmpl</code> 是一个 Go 模板文件，并且 <code>config.Node</code> 结构会被传递给模板。有关如何使用该结构自定义配置文件的示例，请参见<a href="https://github.com/k3s-io/k3s/blob/master/pkg/agent/templates/templates.go#L16-L32" target="_blank" rel="noopener noreferrer">此模板</a>。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="配置-http-代理">配置 HTTP 代理<a href="#配置-http-代理" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h2>
<p>如果你运行 RKE2 的环境中只通过 HTTP 代理进行外部连接，你可以在 RKE2 的 systemd 服务上配置代理。RKE2 将使用这些代理设置，并向下传递到嵌入式 containerd 和 kubelet。</p>
<p>将必要的 <code>HTTP_PROXY</code>、<code>HTTPS_PROXY</code> 和 <code>NO_PROXY</code> 变量添加到 systemd 服务的环境文件中，通常是：</p>
<ul>
<li><code>/etc/default/rke2-server</code></li>
<li><code>/etc/default/rke2-agent</code></li>
</ul>
<p>RKE2 会自动将集群内部 Pod 和 Service IP 范围以及集群 DNS 域添加到 <code>NO_PROXY</code> 条目列表中。你需要确保 Kubernetes 节点本身使用的 IP 地址范围（即节点的公共和私有 IP）包含在 <code>NO_PROXY</code> 列表中，或者可以通过代理访问节点。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">HTTP_PROXY=http://your-proxy.example.com:8888</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">HTTPS_PROXY=http://your-proxy.example.com:8888</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">NO_PROXY=127.0.0.0/8,10.0.0.0/8,172.16.0.0/12,192.168.0.0/16</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如果你想在不影响 RKE2 和 Kubelet 的情况下为 containerd 配置代理，你可以在变量前加上 <code>CONTAINERD_</code>：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">CONTAINERD_HTTP_PROXY=http://your-proxy.example.com:8888</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">CONTAINERD_HTTPS_PROXY=http://your-proxy.example.com:8888</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">CONTAINERD_NO_PROXY=127.0.0.0/8,10.0.0.0/8,172.16.0.0/12,192.168.0.0/16</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="节点标签和污点">节点标签和污点<a href="#节点标签和污点" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h2>
<p>RKE2 Agent 可以通过 <code>node-label</code> 和 <code>node-taint</code> 选项来配置，它们会为 kubelet 添加标签和污点。这两个选项只能在注册时添加标签和/或污点，因此它们只能被添加一次，之后不能再通过运行 rke2 命令来移除。</p>
<p>如果你想在节点注册后更改节点标签和污点，你需要使用 <code>kubectl</code>。关于如何添加<a href="https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/" target="_blank" rel="noopener noreferrer">污点</a>和<a href="https://kubernetes.io/docs/tasks/configure-pod-container/assign-pods-nodes/#add-a-label-to-a-node" target="_blank" rel="noopener noreferrer">节点标签</a>的详细信息，请参阅官方 Kubernetes 文档。</p>
<h1>Agent 节点注册的工作原理</h1>
<p>Agent 节点通过 <code>rke2 agent</code> 进程发起的 WebSocket 连接进行注册，连接由作为 agent 进程一部分运行的客户端负载均衡器维护。</p>
<p>Agent 将使用 join token 的集群 Secret 以及随机生成的节点密码注册到 Server，密码存储在 <code>/etc/rancher/node/password</code> 中。Server 会将各个节点的密码存储为 Kubernetes Secret，后续的任何尝试都必须使用相同的密码。节点密码 Secret 存储在 <code>kube-system</code> 命名空间中，名称使用 <code>&lt;host&gt;.node-password.rke2</code> 模板。当相应的 Kubernetes 节点被删除时，这些 Secret 也会被删除。</p>
<p>注意：在 RKE2 v1.20.2 之前，Server 将密码存储在磁盘上的 <code>/var/lib/rancher/rke2/server/cred/node-passwd</code> 中。</p>
<p>如果 Agent 的 <code>/etc/rancher/node</code> 目录被删除，你需要在启动前为 Agent 重新创建密码文件，或者从 Server 或 Kubernetes 集群中删除该条目（取决于 RKE2版本）。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="使用安装脚本启动-server">使用安装脚本启动 Server<a href="#使用安装脚本启动-server" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h2>
<p>安装脚本为 systemd 提供了单元，但默认情况下不启用或启动该服务。</p>
<p>使用 systemd 运行时，日志将在 <code>/var/log/syslog</code> 中创建，你可以通过 <code>journalctl -u rke2-server</code> 或 <code>journalctl -u rke2-agent</code> 查看日志。</p>
<p>使用安装脚本安装的示例：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">curl -sfL https://get.rke2.io | sh -</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">systemctl enable rke2-server</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">systemctl start rke2-server</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_BuS1"><p>中国用户，可以使用以下方法加速安装：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">curl -sfL https://rancher-mirror.rancher.cn/rke2/install.sh | INSTALL_RKE2_MIRROR=cn sh -</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">systemctl enable rke2-server</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">systemctl start rke2-server</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="禁用-server-chart">禁用 Server Chart<a href="#禁用-server-chart" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h2>
<p>在集群引导期间与 <code>rke2</code> 绑在一起的 Server Chart 可以被禁用并替换。常见的用例是替换捆绑的 <code>rke2-ingress-nginx</code> Chart。</p>
<p>要禁用任何捆绑的系统 Chart，请在引导之前在配置文件中设置 <code>disable</code> 参数。要禁用的系统 Chart 完整列表：</p>
<ul>
<li><code>rke2-canal</code></li>
<li><code>rke2-coredns</code></li>
<li><code>rke2-ingress-nginx</code></li>
<li><code>rke2-metrics-server</code></li>
</ul>
<p>请注意，由于 server Chart 对集群的操作非常重要，因此集群操作人员需要确保已禁用或更换组件。有关集群中各个系统 Chart 角色的更多信息，请参阅<a href="/zh/architecture#server-charts">架构概述</a>。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="在分类的-aws-区域或具有自定义-aws-api-端点的网络上安装">在分类的 AWS 区域或具有自定义 AWS API 端点的网络上安装<a href="#在分类的-aws-区域或具有自定义-aws-api-端点的网络上安装" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h2>
<p>在公共 AWS 区域，为确保 RKE2 支持云并且能够自动配置某些云资源，请使用以下内容配置 RKE2：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># /etc/rancher/rke2/config.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">cloud-provider-name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> aws</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在分类区域（例如 SC2S 或 C2S）上安装 RKE2 时，你需要注意一些额外的条件，从而确保 RKE2 知道如何以及在哪里与适当的 AWS 端点进行安全通信。</p>
<ol start="0">
<li>
<p>确保满足所有常见的 AWS 云提供商<a href="https://rancher.com/docs/rke/latest/en/config-options/cloud-providers/aws/" target="_blank" rel="noopener noreferrer">先决条件</a>。它们与区域无关，并且始终是必需的。</p>
</li>
<li>
<p>通过创建 <code>cloud.conf</code> 文件确保 RKE2 知道将 <code>ec2</code> 和 <code>elasticloadbalancing</code> 服务的 API 请求发送到哪里，以下是 <code>us-iso-east-1</code> (C2S) 区域的示例：</p>
</li>
</ol>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># /etc/rancher/rke2/cloud.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">Global</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">ServiceOverride &quot;ec2&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Service=ec2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Region=us</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">iso</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">east</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  URL=https</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">//ec2.us</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">iso</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">east</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">1.c2s.ic.gov</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  SigningRegion=us</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">iso</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">east</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">ServiceOverride &quot;elasticloadbalancing&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Service=elasticloadbalancing</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Region=us</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">iso</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">east</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  URL=https</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">//elasticloadbalancing.us</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">iso</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">east</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">1.c2s.ic.gov</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  SigningRegion=us</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">iso</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">east</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如果你使用的是<a href="https://docs.aws.amazon.com/vpc/latest/privatelink/endpoint-services-overview.html" target="_blank" rel="noopener noreferrer">私有 AWS 端点</a>，请确保为每个私有端点使用适当的 <code>URL</code>。</p>
<ol start="2">
<li>确保将适当的 AWS CA 包加载到系统的根 CA 信任库中。该操作可能已完成，具体取决于你使用的 AMI。</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># on CentOS/RHEL 7/8</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cp &lt;ca.pem&gt; /etc/pki/ca-trust/source/anchors/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">update-ca-trust</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="3">
<li>使用在步骤 1 中创建的自定义 <code>cloud.conf</code> 配置 RKE2，以使用 <code>aws</code> 云提供商：</li>
</ol>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># /etc/rancher/rke2/config.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">cloud-provider-name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> aws</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">cloud-provider-config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/etc/rancher/rke2/cloud.conf&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="4">
<li>
<p><a href="/zh/install/methods">正常安装</a> RKE2（很可能使用<a href="/zh/install/airgap">离线</a>安装）。</p>
</li>
<li>
<p>使用 <code>kubectl get nodes --show-labels</code> 确认集群节点标签上是否存在 AWS 元数据，从而验证安装是否成功。</p>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="control-plane-组件资源请求限制">Control Plane 组件资源请求/限制<a href="#control-plane-组件资源请求限制" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h2>
<p>以下选项在 RKE2 的 <code>server</code> 子命令下可用。这些选项允许为 RKE2 中的 control plane 组件指定 CPU 请求和限制。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">   --control-plane-resource-requests value       (components) Control Plane resource requests [$RKE2_CONTROL_PLANE_RESOURCE_REQUESTS]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   --control-plane-resource-limits value         (components) Control Plane resource limits [$RKE2_CONTROL_PLANE_RESOURCE_LIMITS]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>值是 <code>[controlplane-component]-(cpu|memory)=[desired-value]</code> 格式的逗号分隔列表。<code>controlplane-component</code> 的值可能是：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">kube-apiserver</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kube-scheduler</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kube-controller-manager</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kube-proxy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">etcd</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cloud-controller-manager</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>因此，示例配置值可能如下所示：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># /etc/rancher/rke2/config.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">control-plane-resource-requests</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> kube</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">apiserver</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">cpu=500m</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> kube</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">apiserver</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">memory=512M</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> kube</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">scheduler</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">cpu=250m</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> kube</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">scheduler</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">memory=512M</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> etcd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">cpu=1000m</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>CPU/内存的单位值与 Kubernetes 资源单位相同（参见 <a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/#resource-units-in-kubernetes" target="_blank" rel="noopener noreferrer">Kubernetes 中的资源限制</a>）。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="额外的-control-plane-组件卷挂载">额外的 control plane 组件卷挂载<a href="#额外的-control-plane-组件卷挂载" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h2>
<p>以下选项在 RKE2 的 <code>server</code> 子命令下可用。些选项指定主机路径，将节点文件系统中的目录挂载到与前缀名称相对应的静态 Pod 组件中。</p>
<table><thead><tr><th>标志</th><th>ENV VAR</th></tr></thead><tbody><tr><td><code>--kube-apiserver-extra-mount</code></td><td>RKE2_KUBE_APISERVER_EXTRA_MOUNT</td></tr><tr><td><code>--kube-scheduler-extra-mount</code></td><td>RKE2_KUBE_SCHEDULER_EXTRA_MOUNT</td></tr><tr><td><code>--kube-controller-manager-extra-mount</code></td><td>RKE2_KUBE_CONTROLLER_MANAGER_EXTRA_MOUNT</td></tr><tr><td><code>--kube-proxy-extra-mount</code></td><td>RKE2_KUBE_PROXY_EXTRA_MOUNT</td></tr><tr><td><code>--etcd-extra-mount</code></td><td>RKE2_ETCD_EXTRA_MOUNT</td></tr><tr><td><code>--cloud-controller-manager-extra-mount</code></td><td>RKE2_CLOUD_CONTROLLER_MANAGER_EXTRA_MOUNT</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="rw-主机路径卷挂载">RW 主机路径卷挂载<a href="#rw-主机路径卷挂载" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3>
<p><code>/source/volume/path/on/host:/destination/volume/path/in/staticpod</code></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ro-主机路径卷挂载">RO 主机路径卷挂载<a href="#ro-主机路径卷挂载" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3>
<p>要将卷挂载为只读，在卷挂载的最后加上 <code>:ro</code>。
<code>/source/volume/path/on/host:/destination/volume/path/in/staticpod:ro</code></p>
<p>通过在配置文件中以数组形式传递标志值，可以为同一个组件指定多个卷挂载。</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># /etc/rancher/rke2/config.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">kube-apiserver-extra-mount</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/tmp/foo.yaml:/root/foo.yaml&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/tmp/bar.txt:/etc/bar.txt:ro&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="额外的-control-plane-组件环境变量">额外的 Control Plane 组件环境变量<a href="#额外的-control-plane-组件环境变量" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h2>
<p>以下选项在 RKE2 的 <code>server</code> 子命令下可用。这些选项以标准格式指定额外的环境变量，即 <code>KEY=VALUE</code>，用于与前缀名称相对应的静态 Pod 组件。</p>
<table><thead><tr><th>标志</th><th>ENV VAR</th></tr></thead><tbody><tr><td><code>--kube-apiserver-extra-env</code></td><td>RKE2_KUBE_APISERVER_EXTRA_ENV</td></tr><tr><td><code>--kube-scheduler-extra-env</code></td><td>RKE2_KUBE_SCHEDULER_EXTRA_ENV</td></tr><tr><td><code>--kube-controller-manager-extra-env</code></td><td>RKE2_KUBE_CONTROLLER_MANAGER_EXTRA_ENV</td></tr><tr><td><code>--kube-proxy-extra-env</code></td><td>RKE2_KUBE_PROXY_EXTRA_ENV</td></tr><tr><td><code>--etcd-extra-env</code></td><td>RKE2_ETCD_EXTRA_ENV</td></tr><tr><td><code>--cloud-controller-manager-extra-env</code></td><td>RKE2_CLOUD_CONTROLLER_MANAGER_EXTRA_ENV</td></tr></tbody></table>
<p>通过在配置文件中以数组形式传递标志值，可以为同一个组件指定多个环境变量。</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># /etc/rancher/rke2/config.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">kube-apiserver-extra-env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;MY_FOO=FOO&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;MY_BAR=BAR&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">kube-scheduler-extra-env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;TZ=America/Los_Angeles&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/rancher/rke2-docs/edit/main/docs/advanced.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">最后<!-- -->于 <b><time datetime="2024-02-16T19:00:28.000Z">2024年2月16日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/zh/helm"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Helm 集成</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/zh/reference/cli_tools"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">CLI 工具</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#证书轮换" class="table-of-contents__link toc-highlight">证书轮换</a></li><li><a href="#自动部署清单" class="table-of-contents__link toc-highlight">自动部署清单</a></li><li><a href="#配置-containerd" class="table-of-contents__link toc-highlight">配置 Containerd</a></li><li><a href="#配置-http-代理" class="table-of-contents__link toc-highlight">配置 HTTP 代理</a></li><li><a href="#节点标签和污点" class="table-of-contents__link toc-highlight">节点标签和污点</a></li><li><a href="#使用安装脚本启动-server" class="table-of-contents__link toc-highlight">使用安装脚本启动 Server</a></li><li><a href="#禁用-server-chart" class="table-of-contents__link toc-highlight">禁用 Server Chart</a></li><li><a href="#在分类的-aws-区域或具有自定义-aws-api-端点的网络上安装" class="table-of-contents__link toc-highlight">在分类的 AWS 区域或具有自定义 AWS API 端点的网络上安装</a></li><li><a href="#control-plane-组件资源请求限制" class="table-of-contents__link toc-highlight">Control Plane 组件资源请求/限制</a></li><li><a href="#额外的-control-plane-组件卷挂载" class="table-of-contents__link toc-highlight">额外的 control plane 组件卷挂载</a><ul><li><a href="#rw-主机路径卷挂载" class="table-of-contents__link toc-highlight">RW 主机路径卷挂载</a></li><li><a href="#ro-主机路径卷挂载" class="table-of-contents__link toc-highlight">RO 主机路径卷挂载</a></li></ul></li><li><a href="#额外的-control-plane-组件环境变量" class="table-of-contents__link toc-highlight">额外的 Control Plane 组件环境变量</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 SUSE Rancher. All Rights Reserved.</div></div></div></footer></div>
</body>
</html>