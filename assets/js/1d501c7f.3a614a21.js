"use strict";(self.webpackChunkrke_2_docs=self.webpackChunkrke_2_docs||[]).push([[5329],{5614:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>d,frontMatter:()=>t,metadata:()=>a,toc:()=>c});var s=r(5893),i=r(1151);const t={title:"Quick Start"},l=void 0,a={id:"install/quickstart",title:"Quick Start",description:"This guide will help you quickly launch a cluster with default options.",source:"@site/docs/install/quickstart.md",sourceDirName:"install",slug:"/install/quickstart",permalink:"/install/quickstart",draft:!1,unlisted:!1,editUrl:"https://github.com/rancher/rke2-docs/edit/main/docs/install/quickstart.md",tags:[],version:"current",lastUpdatedAt:1705950330,formattedLastUpdatedAt:"Jan 22, 2024",frontMatter:{title:"Quick Start"},sidebar:"mySidebar",previous:{title:"Introduction",permalink:"/"},next:{title:"Requirements",permalink:"/install/requirements"}},o={},c=[{value:"Prerequisites",id:"prerequisites",level:3},{value:"Server Node Installation",id:"server-node-installation",level:3},{value:"1. Run the installer",id:"1-run-the-installer",level:4},{value:"2. Enable the rke2-server service",id:"2-enable-the-rke2-server-service",level:4},{value:"3. Start the service",id:"3-start-the-service",level:4},{value:"4. Follow the logs, if you like",id:"4-follow-the-logs-if-you-like",level:4},{value:"Linux Agent (Worker) Node Installation",id:"linux-agent-worker-node-installation",level:3},{value:"1. Run the installer",id:"1-run-the-installer-1",level:4},{value:"2. Enable the rke2-agent service",id:"2-enable-the-rke2-agent-service",level:4},{value:"3. Configure the rke2-agent service",id:"3-configure-the-rke2-agent-service",level:4},{value:"4. Start the service",id:"4-start-the-service",level:4},{value:"Windows Agent (Worker) Node Installation",id:"windows-agent-worker-node-installation",level:3},{value:"0. Prepare the Windows Agent Node",id:"0-prepare-the-windows-agent-node",level:4},{value:"1. Download the Install Script",id:"1-download-the-install-script",level:4},{value:"2. Configure the rke2-agent for Windows",id:"2-configure-the-rke2-agent-for-windows",level:4},{value:"3. Configure PATH",id:"3-configure-path",level:4},{value:"4. Run the Installer",id:"4-run-the-installer",level:4},{value:"5. Start the Windows RKE2 Service",id:"5-start-the-windows-rke2-service",level:4}];function h(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h3:"h3",h4:"h4",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"This guide will help you quickly launch a cluster with default options."}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["New to Kubernetes? The official Kubernetes docs already have some great tutorials outlining the basics ",(0,s.jsx)(n.a,{href:"https://kubernetes.io/docs/tutorials/kubernetes-basics/",children:"here"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Make sure your environment fulfills the ",(0,s.jsx)(n.a,{href:"/install/requirements",children:"requirements."}),"\nIf NetworkManager is installed and enabled on your hosts, ",(0,s.jsx)(n.a,{href:"/known_issues#networkmanager",children:"ensure that it is configured to ignore CNI-managed interfaces."})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["For RKE2 versions 1.21 and higher, if the host kernel supports ",(0,s.jsx)(n.a,{href:"https://apparmor.net/",children:"AppArmor"}),", the AppArmor tools (usually available via the ",(0,s.jsx)(n.code,{children:"apparmor-parser"})," package) must also be present prior to installing RKE2."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["The RKE2 installation process must be run as the root user or through ",(0,s.jsx)(n.code,{children:"sudo"}),"."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"server-node-installation",children:"Server Node Installation"}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.p,{children:["RKE2 provides an installation script that is a convenient way to install it as a service on systemd based systems. This script is available at ",(0,s.jsx)(n.a,{href:"https://get.rke2.io",children:"https://get.rke2.io"}),". To install RKE2 using this method do the following:"]}),"\n",(0,s.jsx)(n.h4,{id:"1-run-the-installer",children:"1. Run the installer"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"curl -sfL https://get.rke2.io | sh -\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This will install the ",(0,s.jsx)(n.code,{children:"rke2-server"})," service and the ",(0,s.jsx)(n.code,{children:"rke2"})," binary onto your machine. Due to its nature, It will fail unless it runs as the root user or through ",(0,s.jsx)(n.code,{children:"sudo"}),"."]}),"\n",(0,s.jsx)(n.h4,{id:"2-enable-the-rke2-server-service",children:"2. Enable the rke2-server service"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"systemctl enable rke2-server.service\n"})}),"\n",(0,s.jsx)(n.h4,{id:"3-start-the-service",children:"3. Start the service"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"systemctl start rke2-server.service\n"})}),"\n",(0,s.jsx)(n.h4,{id:"4-follow-the-logs-if-you-like",children:"4. Follow the logs, if you like"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"journalctl -u rke2-server -f\n"})}),"\n",(0,s.jsx)(n.p,{children:"After running this installation:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["The ",(0,s.jsx)(n.code,{children:"rke2-server"})," service will be installed. The ",(0,s.jsx)(n.code,{children:"rke2-server"})," service will be configured to automatically restart after node reboots or if the process crashes or is killed."]}),"\n",(0,s.jsxs)(n.li,{children:["Additional utilities will be installed at ",(0,s.jsx)(n.code,{children:"/var/lib/rancher/rke2/bin/"}),". They include: ",(0,s.jsx)(n.code,{children:"kubectl"}),", ",(0,s.jsx)(n.code,{children:"crictl"}),", and ",(0,s.jsx)(n.code,{children:"ctr"}),". Note that these are not on your path by default."]}),"\n",(0,s.jsxs)(n.li,{children:["Two cleanup scripts, ",(0,s.jsx)(n.code,{children:"rke2-killall.sh"})," and ",(0,s.jsx)(n.code,{children:"rke2-uninstall.sh"}),", will be installed to the path at:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"/usr/local/bin"})," for regular file systems"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"/opt/rke2/bin"})," for read-only and brtfs file systems"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"INSTALL_RKE2_TAR_PREFIX/bin"})," if ",(0,s.jsx)(n.code,{children:"INSTALL_RKE2_TAR_PREFIX"})," is set"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["A ",(0,s.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/configuration/organize-cluster-access-kubeconfig/",children:"kubeconfig"})," file will be written to ",(0,s.jsx)(n.code,{children:"/etc/rancher/rke2/rke2.yaml"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["A token that can be used to register other server or agent nodes will be created at ",(0,s.jsx)(n.code,{children:"/var/lib/rancher/rke2/server/node-token"})]}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:["If you are adding additional server nodes, you must have an odd number in total. An odd number is needed to maintain quorum. See the ",(0,s.jsx)(n.a,{href:"/install/ha",children:"High Availability documentation"})," for more details."]})}),"\n",(0,s.jsx)(n.h3,{id:"linux-agent-worker-node-installation",children:"Linux Agent (Worker) Node Installation"}),"\n",(0,s.jsxs)(n.p,{children:["The steps on this section requires root level access or ",(0,s.jsx)(n.code,{children:"sudo"})," to work."]}),"\n",(0,s.jsx)(n.h4,{id:"1-run-the-installer-1",children:"1. Run the installer"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:'curl -sfL https://get.rke2.io | INSTALL_RKE2_TYPE="agent" sh -\n'})}),"\n",(0,s.jsxs)(n.p,{children:["This will install the ",(0,s.jsx)(n.code,{children:"rke2-agent"})," service and the ",(0,s.jsx)(n.code,{children:"rke2"})," binary onto your machine. Due to its nature, It will fail unless it runs as the root user or through ",(0,s.jsx)(n.code,{children:"sudo"}),"."]}),"\n",(0,s.jsx)(n.h4,{id:"2-enable-the-rke2-agent-service",children:"2. Enable the rke2-agent service"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"systemctl enable rke2-agent.service\n"})}),"\n",(0,s.jsx)(n.h4,{id:"3-configure-the-rke2-agent-service",children:"3. Configure the rke2-agent service"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"mkdir -p /etc/rancher/rke2/\nvim /etc/rancher/rke2/config.yaml\n"})}),"\n",(0,s.jsx)(n.p,{children:"Content for config.yaml:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"server: https://<server>:9345\ntoken: <token from server node>\n"})}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"rke2 server"})," process listens on port ",(0,s.jsx)(n.code,{children:"9345"})," for new nodes to register. The Kubernetes API is still served on port ",(0,s.jsx)(n.code,{children:"6443"}),", as normal."]})}),"\n",(0,s.jsx)(n.h4,{id:"4-start-the-service",children:"4. Start the service"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"systemctl start rke2-agent.service\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Follow the logs, if you like"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"journalctl -u rke2-agent -f\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note:"})," Each machine must have a unique hostname. If your machines do not have unique hostnames, set the ",(0,s.jsx)(n.code,{children:"node-name"})," parameter in the ",(0,s.jsx)(n.code,{children:"config.yaml"})," file and provide a value with a valid and unique hostname for each node."]}),"\n",(0,s.jsxs)(n.p,{children:["To read more about the config.yaml file, see the ",(0,s.jsx)(n.a,{href:"/install/configuration#configuration-file",children:"Install Options documentation."})]}),"\n",(0,s.jsx)(n.h3,{id:"windows-agent-worker-node-installation",children:"Windows Agent (Worker) Node Installation"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Windows Support is currently Experimental as of v1.21.3+rke2r1"}),"\n",(0,s.jsx)(n.strong,{children:"Windows Support requires choosing Calico as the CNI for the RKE2 cluster"})]}),"\n",(0,s.jsx)(n.h4,{id:"0-prepare-the-windows-agent-node",children:"0. Prepare the Windows Agent Node"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note"})," The Windows Server Containers feature needs to be enabled for the RKE2 agent to work."]}),"\n",(0,s.jsx)(n.p,{children:"Open a new Powershell window with Administrator privileges"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:'powershell -Command "Start-Process PowerShell -Verb RunAs"\n'})}),"\n",(0,s.jsx)(n.p,{children:"In the new Powershell window, run the following command."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:"Enable-WindowsOptionalFeature -Online -FeatureName containers \u2013All\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This will require a reboot for the ",(0,s.jsx)(n.code,{children:"Containers"})," feature to properly function."]}),"\n",(0,s.jsx)(n.h4,{id:"1-download-the-install-script",children:"1. Download the Install Script"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:"Invoke-WebRequest -Uri https://raw.githubusercontent.com/rancher/rke2/master/install.ps1 -Outfile install.ps1\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This script will download the ",(0,s.jsx)(n.code,{children:"rke2.exe"})," Windows binary onto your machine."]}),"\n",(0,s.jsx)(n.h4,{id:"2-configure-the-rke2-agent-for-windows",children:"2. Configure the rke2-agent for Windows"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:'New-Item -Type Directory c:/etc/rancher/rke2 -Force\nSet-Content -Path c:/etc/rancher/rke2/config.yaml -Value @"\nserver: https://<server>:9345\ntoken: <token from server node>\n"@\n'})}),"\n",(0,s.jsxs)(n.p,{children:["To read more about the config.yaml file, see the ",(0,s.jsx)(n.a,{href:"/install/configuration#configuration-file",children:"Install Options documentation."})]}),"\n",(0,s.jsx)(n.h4,{id:"3-configure-path",children:"3. Configure PATH"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:'$env:PATH+=";c:\\var\\lib\\rancher\\rke2\\bin;c:\\usr\\local\\bin"\n\n[Environment]::SetEnvironmentVariable(\n    "Path",\n    [Environment]::GetEnvironmentVariable("Path", [EnvironmentVariableTarget]::Machine) + ";c:\\var\\lib\\rancher\\rke2\\bin;c:\\usr\\local\\bin",\n    [EnvironmentVariableTarget]::Machine)\n'})}),"\n",(0,s.jsx)(n.h4,{id:"4-run-the-installer",children:"4. Run the Installer"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:"./install.ps1\n"})}),"\n",(0,s.jsx)(n.h4,{id:"5-start-the-windows-rke2-service",children:"5. Start the Windows RKE2 Service"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:"rke2.exe agent service --add\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note:"})," Each machine must have a unique hostname."]}),"\n",(0,s.jsx)(n.p,{children:"Don't forget to start the RKE2 service with:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:"Start-Service rke2\n"})}),"\n",(0,s.jsx)(n.p,{children:"If you would prefer to use CLI parameters only instead, run the binary with the desired parameters."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:"rke2.exe agent --token <> --server <>\n"})})]})}function d(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},1151:(e,n,r)=>{r.d(n,{Z:()=>a,a:()=>l});var s=r(7294);const i={},t=s.createContext(i);function l(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);