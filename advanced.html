<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-advanced" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">Advanced Options and Configuration | RKE2</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.rke2.io/advanced"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="zh"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Advanced Options and Configuration | RKE2"><meta data-rh="true" name="description" content="This section contains advanced information describing the different ways you can run and manage RKE2."><meta data-rh="true" property="og:description" content="This section contains advanced information describing the different ways you can run and manage RKE2."><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://docs.rke2.io/advanced"><link data-rh="true" rel="alternate" href="https://docs.rke2.io/advanced" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.rke2.io/zh/advanced" hreflang="zh"><link data-rh="true" rel="alternate" href="https://docs.rke2.io/advanced" hreflang="x-default"><link rel="preconnect" href="https://www.googletagmanager.com">
<script>window.dataLayer=window.dataLayer||[]</script>
<script>!function(e,t,a,n,g){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var m=t.getElementsByTagName(a)[0],r=t.createElement(a);r.async=!0,r.src="https://www.googletagmanager.com/gtm.js?id=GTM-57KS2MW",m.parentNode.insertBefore(r,m)}(window,document,"script","dataLayer")</script><link rel="stylesheet" href="/assets/css/styles.700d0e6d.css">
<script src="/assets/js/runtime~main.bfbb5ce6.js" defer="defer"></script>
<script src="/assets/js/main.fc09fb5b.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-57KS2MW" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo-horizontal-rke2.svg" alt="logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo-horizontal-rke2-dark.svg" alt="logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a></div><div class="navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/advanced" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><a href="/zh/advanced" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh">简体中文</a></li></ul></div><a href="https://github.com/rancher/rke2" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar__icon navbar__github">GitHub</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">More From SUSE</a><ul class="dropdown__menu"><li><a href="https://www.rancher.com" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__rancher">Rancher</a></li><li><hr style="margin: 0.3rem 0;"></li><li><a href="http://harvesterhci.io" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__harvester">Harvester</a></li><li><a href="https://rancherdesktop.io" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__rd">Rancher Desktop</a></li><li><a href="https://kubewarden.io" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__kubewarden">Kubewarden</a></li><li><hr style="margin: 0.3rem 0;"></li><li><a href="https://opensource.suse.com" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__suse">More Projects...</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/install/quickstart">Installation</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/upgrade">Upgrades</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/security/about_hardened_images">Security</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/architecture">Architecture</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/cluster_access">Cluster Access</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/backup_restore">Etcd Backup and Restore</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/networking">Networking</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/helm">Helm Integration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/advanced">Advanced Options and Configuration</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/reference/cli_tools">Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/release-notes/v1.29.X">Release Notes</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/known_issues">Known Issues and Limits</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Advanced Options and Configuration</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Advanced Options and Configuration</h1></header><p>This section contains advanced information describing the different ways you can run and manage RKE2.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="certificate-rotation">Certificate Rotation<a href="#certificate-rotation" class="hash-link" aria-label="Direct link to Certificate Rotation" title="Direct link to Certificate Rotation">​</a></h2>
<p>By default, certificates in RKE2 expire in 12 months.</p>
<p>If the certificates are expired or have fewer than 90 days remaining before they expire, the certificates are rotated when RKE2 is restarted.</p>
<p>As of v1.21.8+rke2r1, certificates can also be rotated manually. To do this, it is best to stop the rke2-server process, rotate the certificates, then start the process up again:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">systemctl stop rke2-server</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">rke2 certificate rotate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">systemctl start rke2-server</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To renew agent certificates, restart rke2-agent in agent nodes. Agent certificates are renewed every time the agent starts.</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">systemctl restart rke2-agent</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>It is also possible to rotate an individual service by passing the <code>--service</code> flag, for example: <code>rke2 certificate rotate --service api-server</code>. See <a href="/security/certificates#rotating-client-and-server-certificates-manually">Certificate Management</a> for more details.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="auto-deploying-manifests">Auto-Deploying Manifests<a href="#auto-deploying-manifests" class="hash-link" aria-label="Direct link to Auto-Deploying Manifests" title="Direct link to Auto-Deploying Manifests">​</a></h2>
<p>Any file found in <code>/var/lib/rancher/rke2/server/manifests</code> will automatically be deployed to Kubernetes in a manner similar to <code>kubectl apply</code>.</p>
<p>For information about deploying Helm charts using the manifests directory, refer to the section about <a href="/helm">Helm.</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuring-containerd">Configuring containerd<a href="#configuring-containerd" class="hash-link" aria-label="Direct link to Configuring containerd" title="Direct link to Configuring containerd">​</a></h2>
<p>RKE2 will generate the <code>config.toml</code> for containerd in <code>/var/lib/rancher/rke2/agent/etc/containerd/config.toml</code>.</p>
<p>For advanced customization of this file you can create another file called <code>config.toml.tmpl</code> in the same directory and it will be used instead.</p>
<p>The <code>config.toml.tmpl</code> will be treated as a Go template file, and the <code>config.Node</code> structure is being passed to the template. See <a href="https://github.com/k3s-io/k3s/blob/master/pkg/agent/templates/templates.go#L16-L32" target="_blank" rel="noopener noreferrer">this template</a> for an example of how to use the structure to customize the configuration file.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuring-an-http-proxy">Configuring an HTTP proxy<a href="#configuring-an-http-proxy" class="hash-link" aria-label="Direct link to Configuring an HTTP proxy" title="Direct link to Configuring an HTTP proxy">​</a></h2>
<p>If you are running RKE2 in an environment, which only has external connectivity through an HTTP proxy, you can configure your proxy settings on the RKE2 systemd service. These proxy settings will then be used in RKE2 and passed down to the embedded containerd and kubelet.</p>
<p>Add the necessary <code>HTTP_PROXY</code>, <code>HTTPS_PROXY</code> and <code>NO_PROXY</code> variables to the environment file of your systemd service, usually:</p>
<ul>
<li><code>/etc/default/rke2-server</code></li>
<li><code>/etc/default/rke2-agent</code></li>
</ul>
<p>RKE2 will automatically add the cluster internal Pod and Service IP ranges and cluster DNS domain to the list of <code>NO_PROXY</code> entries. You should ensure that the IP address ranges used by the Kubernetes nodes themselves (i.e. the public and private IPs of the nodes) are included in the <code>NO_PROXY</code> list, or that the nodes can be reached through the proxy.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">HTTP_PROXY=http://your-proxy.example.com:8888</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">HTTPS_PROXY=http://your-proxy.example.com:8888</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">NO_PROXY=127.0.0.0/8,10.0.0.0/8,172.16.0.0/12,192.168.0.0/16</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If you want to configure the proxy settings for containerd without affecting RKE2 and the Kubelet, you can prefix the variables with <code>CONTAINERD_</code>:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">CONTAINERD_HTTP_PROXY=http://your-proxy.example.com:8888</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">CONTAINERD_HTTPS_PROXY=http://your-proxy.example.com:8888</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">CONTAINERD_NO_PROXY=127.0.0.0/8,10.0.0.0/8,172.16.0.0/12,192.168.0.0/16</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="node-labels-and-taints">Node Labels and Taints<a href="#node-labels-and-taints" class="hash-link" aria-label="Direct link to Node Labels and Taints" title="Direct link to Node Labels and Taints">​</a></h2>
<p>RKE2 agents can be configured with the options <code>node-label</code> and <code>node-taint</code> which adds a label and taint to the kubelet. The two options only add labels and/or taints at registration time, and can only be added once and not removed after that through rke2 commands.</p>
<p>If you want to change node labels and taints after node registration you should use <code>kubectl</code>. Refer to the official Kubernetes documentation for details on how to add <a href="https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/" target="_blank" rel="noopener noreferrer">taints</a> and <a href="https://kubernetes.io/docs/tasks/configure-pod-container/assign-pods-nodes/#add-a-label-to-a-node" target="_blank" rel="noopener noreferrer">node labels</a>.</p>
<h1>How Agent Node Registration Works</h1>
<p>Agent nodes are registered via a websocket connection initiated by the <code>rke2 agent</code> process, and the connection is maintained by a client-side load balancer running as part of the agent process.</p>
<p>Agents register with the server using the cluster secret portion of the join token, along with a randomly generated node-specific password, which is stored on the agent at <code>/etc/rancher/node/password</code>. The server will store the passwords for individual nodes as Kubernetes secrets, and any subsequent attempts must use the same password. Node password secrets are stored in the <code>kube-system</code> namespace with names using the template <code>&lt;host&gt;.node-password.rke2</code>. These secrets are deleted when the corresponding Kubernetes node is deleted.</p>
<p>Note: Prior to RKE2 v1.20.2 servers stored passwords on disk at <code>/var/lib/rancher/rke2/server/cred/node-passwd</code>.</p>
<p>If the <code>/etc/rancher/node</code> directory of an agent is removed, the password file should be recreated for the agent prior to startup, or the entry removed from the server or Kubernetes cluster (depending on the RKE2 version).</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="starting-the-server-with-the-installation-script">Starting the Server with the Installation Script<a href="#starting-the-server-with-the-installation-script" class="hash-link" aria-label="Direct link to Starting the Server with the Installation Script" title="Direct link to Starting the Server with the Installation Script">​</a></h2>
<p>The installation script provides units for systemd, but does not enable or start the service by default.</p>
<p>When running with systemd, logs will be created in <code>/var/log/syslog</code> and viewed using <code>journalctl -u rke2-server</code> or <code>journalctl -u rke2-agent</code>.</p>
<p>An example of installing with the install script:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">curl -sfL https://get.rke2.io | sh -</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">systemctl enable rke2-server</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">systemctl start rke2-server</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="disabling-server-charts">Disabling Server Charts<a href="#disabling-server-charts" class="hash-link" aria-label="Direct link to Disabling Server Charts" title="Direct link to Disabling Server Charts">​</a></h2>
<p>The server charts bundled with <code>rke2</code> deployed during cluster bootstrapping can be disabled and replaced with alternatives.  A common use case is replacing the bundled <code>rke2-ingress-nginx</code> chart with an alternative.</p>
<p>To disable any of the bundled system charts, set the <code>disable</code> parameter in the config file before bootstrapping. An example of disabling all available system charts is:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># /etc/rancher/rke2/config.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">disable</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> rke2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">coredns</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> rke2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">ingress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">nginx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> rke2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">metrics</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">server</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> rke2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">snapshot</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">controller</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> rke2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">snapshot</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">controller</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">crd</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> rke2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">snapshot</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">validation</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">webhook</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>It is the cluster operator&#x27;s responsibility to ensure that components are disabled or replaced with care, as the server charts play important roles in cluster operability.  Refer to the <a href="/architecture#server-charts">architecture overview</a> for more information on the individual system charts role within the cluster.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="installation-on-classified-aws-regions-or-networks-with-custom-aws-api-endpoints">Installation on classified AWS regions or networks with custom AWS API endpoints<a href="#installation-on-classified-aws-regions-or-networks-with-custom-aws-api-endpoints" class="hash-link" aria-label="Direct link to Installation on classified AWS regions or networks with custom AWS API endpoints" title="Direct link to Installation on classified AWS regions or networks with custom AWS API endpoints">​</a></h2>
<p>In public AWS regions, to ensure RKE2 is cloud-enabled, and capable of auto-provisioning certain cloud resources, config RKE2 with:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># /etc/rancher/rke2/config.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">cloud-provider-name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> aws</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>When installing RKE2 on classified regions (such as SC2S or C2S), there are a few additional pre-requisites to be aware of to ensure RKE2 knows how and where to securely communicate with the appropriate AWS endpoints:</p>
<ol start="0">
<li>
<p>Ensure all the common AWS cloud-provider <a href="https://rancher.com/docs/rke/latest/en/config-options/cloud-providers/aws/" target="_blank" rel="noopener noreferrer">prerequisites</a> are met.  These are independent of regions and are always required.</p>
</li>
<li>
<p>Ensure RKE2 knows where to send API requests for <code>ec2</code> and <code>elasticloadbalancing</code> services by creating a <code>cloud.conf</code> file, the below is an example for the <code>us-iso-east-1</code> (C2S) region:</p>
</li>
</ol>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># /etc/rancher/rke2/cloud.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">Global</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">ServiceOverride &quot;ec2&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Service=ec2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Region=us</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">iso</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">east</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  URL=https</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">//ec2.us</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">iso</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">east</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">1.c2s.ic.gov</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  SigningRegion=us</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">iso</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">east</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">ServiceOverride &quot;elasticloadbalancing&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Service=elasticloadbalancing</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Region=us</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">iso</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">east</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  URL=https</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">//elasticloadbalancing.us</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">iso</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">east</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">1.c2s.ic.gov</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  SigningRegion=us</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">iso</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">east</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Alternatively, if you are using <a href="https://docs.aws.amazon.com/vpc/latest/privatelink/endpoint-services-overview.html" target="_blank" rel="noopener noreferrer">private AWS endpoints</a>, ensure the appropriate <code>URL</code> is used for each of the private endpoints.</p>
<ol start="2">
<li>Ensure the appropriate AWS CA bundle is loaded into the system&#x27;s root ca trust store.  This may already be done for you depending on the AMI you are using.</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># on CentOS/RHEL 7/8</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cp &lt;ca.pem&gt; /etc/pki/ca-trust/source/anchors/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">update-ca-trust</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="3">
<li>Configure RKE2 to use the <code>aws</code> cloud-provider with the custom <code>cloud.conf</code> created in step 1:</li>
</ol>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># /etc/rancher/rke2/config.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">cloud-provider-name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> aws</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">cloud-provider-config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/etc/rancher/rke2/cloud.conf&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="4">
<li>
<p><a href="/install/methods">Install</a> RKE2 normally (most likely in an <a href="/install/airgap">airgapped</a> capacity)</p>
</li>
<li>
<p>Validate successful installation by confirming the existence of AWS metadata on cluster node labels with <code>kubectl get nodes --show-labels</code></p>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="control-plane-component-resource-requestslimits">Control Plane Component Resource Requests/Limits<a href="#control-plane-component-resource-requestslimits" class="hash-link" aria-label="Direct link to Control Plane Component Resource Requests/Limits" title="Direct link to Control Plane Component Resource Requests/Limits">​</a></h2>
<p>The following options are available under the <code>server</code> sub-command for RKE2. The options allow for specifying CPU requests and limits for the control plane components within RKE2.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">   --control-plane-resource-requests value       (components) Control Plane resource requests [$RKE2_CONTROL_PLANE_RESOURCE_REQUESTS]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   --control-plane-resource-limits value         (components) Control Plane resource limits [$RKE2_CONTROL_PLANE_RESOURCE_LIMITS]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Values are a comma-delimited list of <code>[controlplane-component]-(cpu|memory)=[desired-value]</code>. The possible values for <code>controlplane-component</code> are:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">kube-apiserver</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kube-scheduler</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kube-controller-manager</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kube-proxy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">etcd</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cloud-controller-manager</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Thus, an example config may value may look like:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># /etc/rancher/rke2/config.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">control-plane-resource-requests</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> kube</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">apiserver</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">cpu=500m</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> kube</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">apiserver</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">memory=512M</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> kube</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">scheduler</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">cpu=250m</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> kube</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">scheduler</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">memory=512M</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> etcd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">cpu=1000m</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The unit values for CPU/memory are identical to Kubernetes resource units (See: <a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/#resource-units-in-kubernetes" target="_blank" rel="noopener noreferrer">Resource Limits in Kubernetes</a>)</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="extra-control-plane-component-volume-mounts">Extra Control Plane Component Volume Mounts<a href="#extra-control-plane-component-volume-mounts" class="hash-link" aria-label="Direct link to Extra Control Plane Component Volume Mounts" title="Direct link to Extra Control Plane Component Volume Mounts">​</a></h2>
<p>The following options are available under the <code>server</code> sub-command for RKE2. These options specify host-path mounting of directories from the node filesystem into the static pod component that corresponds to the prefixed name.</p>
<table><thead><tr><th>Flag</th><th>ENV VAR</th></tr></thead><tbody><tr><td><code>--kube-apiserver-extra-mount</code></td><td>RKE2_KUBE_APISERVER_EXTRA_MOUNT</td></tr><tr><td><code>--kube-scheduler-extra-mount</code></td><td>RKE2_KUBE_SCHEDULER_EXTRA_MOUNT</td></tr><tr><td><code>--kube-controller-manager-extra-mount</code></td><td>RKE2_KUBE_CONTROLLER_MANAGER_EXTRA_MOUNT</td></tr><tr><td><code>--kube-proxy-extra-mount</code></td><td>RKE2_KUBE_PROXY_EXTRA_MOUNT</td></tr><tr><td><code>--etcd-extra-mount</code></td><td>RKE2_ETCD_EXTRA_MOUNT</td></tr><tr><td><code>--cloud-controller-manager-extra-mount</code></td><td>RKE2_CLOUD_CONTROLLER_MANAGER_EXTRA_MOUNT</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="rw-host-path-volume-mount">RW Host Path Volume Mount<a href="#rw-host-path-volume-mount" class="hash-link" aria-label="Direct link to RW Host Path Volume Mount" title="Direct link to RW Host Path Volume Mount">​</a></h3>
<p><code>/source/volume/path/on/host:/destination/volume/path/in/staticpod</code></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ro-host-path-volume-mount">RO Host Path Volume Mount<a href="#ro-host-path-volume-mount" class="hash-link" aria-label="Direct link to RO Host Path Volume Mount" title="Direct link to RO Host Path Volume Mount">​</a></h3>
<p>In order to mount a volume as read only, append <code>:ro</code> to the end of the volume mount.
<code>/source/volume/path/on/host:/destination/volume/path/in/staticpod:ro</code></p>
<p>Multiple volume mounts can be specified for the same component by passing the flag values as an array in the config file.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># /etc/rancher/rke2/config.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">kube-apiserver-extra-mount</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/tmp/foo.yaml:/root/foo.yaml&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/tmp/bar.txt:/etc/bar.txt:ro&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="extra-control-plane-component-environment-variables">Extra Control Plane Component Environment Variables<a href="#extra-control-plane-component-environment-variables" class="hash-link" aria-label="Direct link to Extra Control Plane Component Environment Variables" title="Direct link to Extra Control Plane Component Environment Variables">​</a></h2>
<p>The following options are available under the <code>server</code> sub-command for RKE2. These options specify additional environment variables in standard format i.e. <code>KEY=VALUE</code> for the static pod component that corresponds to the prefixed name.</p>
<table><thead><tr><th>Flag</th><th>ENV VAR</th></tr></thead><tbody><tr><td><code>--kube-apiserver-extra-env</code></td><td>RKE2_KUBE_APISERVER_EXTRA_ENV</td></tr><tr><td><code>--kube-scheduler-extra-env</code></td><td>RKE2_KUBE_SCHEDULER_EXTRA_ENV</td></tr><tr><td><code>--kube-controller-manager-extra-env</code></td><td>RKE2_KUBE_CONTROLLER_MANAGER_EXTRA_ENV</td></tr><tr><td><code>--kube-proxy-extra-env</code></td><td>RKE2_KUBE_PROXY_EXTRA_ENV</td></tr><tr><td><code>--etcd-extra-env</code></td><td>RKE2_ETCD_EXTRA_ENV</td></tr><tr><td><code>--cloud-controller-manager-extra-env</code></td><td>RKE2_CLOUD_CONTROLLER_MANAGER_EXTRA_ENV</td></tr></tbody></table>
<p>Multiple environment variables can be specified for the same component by passing the flag values as an array in the config file.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># /etc/rancher/rke2/config.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">kube-apiserver-extra-env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;MY_FOO=FOO&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;MY_BAR=BAR&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">kube-scheduler-extra-env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;TZ=America/Los_Angeles&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/rancher/rke2-docs/edit/main/docs/advanced.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2024-02-26T17:14:13.000Z">Feb 26, 2024</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/helm"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Helm Integration</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/reference/cli_tools"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">CLI Tools</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#certificate-rotation" class="table-of-contents__link toc-highlight">Certificate Rotation</a></li><li><a href="#auto-deploying-manifests" class="table-of-contents__link toc-highlight">Auto-Deploying Manifests</a></li><li><a href="#configuring-containerd" class="table-of-contents__link toc-highlight">Configuring containerd</a></li><li><a href="#configuring-an-http-proxy" class="table-of-contents__link toc-highlight">Configuring an HTTP proxy</a></li><li><a href="#node-labels-and-taints" class="table-of-contents__link toc-highlight">Node Labels and Taints</a></li><li><a href="#starting-the-server-with-the-installation-script" class="table-of-contents__link toc-highlight">Starting the Server with the Installation Script</a></li><li><a href="#disabling-server-charts" class="table-of-contents__link toc-highlight">Disabling Server Charts</a></li><li><a href="#installation-on-classified-aws-regions-or-networks-with-custom-aws-api-endpoints" class="table-of-contents__link toc-highlight">Installation on classified AWS regions or networks with custom AWS API endpoints</a></li><li><a href="#control-plane-component-resource-requestslimits" class="table-of-contents__link toc-highlight">Control Plane Component Resource Requests/Limits</a></li><li><a href="#extra-control-plane-component-volume-mounts" class="table-of-contents__link toc-highlight">Extra Control Plane Component Volume Mounts</a><ul><li><a href="#rw-host-path-volume-mount" class="table-of-contents__link toc-highlight">RW Host Path Volume Mount</a></li><li><a href="#ro-host-path-volume-mount" class="table-of-contents__link toc-highlight">RO Host Path Volume Mount</a></li></ul></li><li><a href="#extra-control-plane-component-environment-variables" class="table-of-contents__link toc-highlight">Extra Control Plane Component Environment Variables</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 SUSE Rancher. All Rights Reserved.</div></div></div></footer></div>
</body>
</html>